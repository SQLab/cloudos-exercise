<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="CloudOS Exercises : Exercises of CloudOS" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>CloudOS Exercises</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/SQLab/cloudos-exercise">View on GitHub</a>

          <h1 id="project_title">CloudOS Exercises</h1>
          <h2 id="project_tagline">Exercises of CloudOS</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/SQLab/cloudos-exercise/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/SQLab/cloudos-exercise/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a name="cloud-operating-system" class="anchor" href="#cloud-operating-system"><span class="octicon octicon-link"></span></a>Cloud Operating System</h1>

<h2>
<a name="exercise-1" class="anchor" href="#exercise-1"><span class="octicon octicon-link"></span></a>Exercise #1</h2>

<h3>
<a name="install-devstack" class="anchor" href="#install-devstack"><span class="octicon octicon-link"></span></a>Install DevStack</h3>

<pre><code>$ git clone https://github.com/openstack-dev/devstack.git
$ cd devstack
$ ./stack.sh
</code></pre>

<h3>
<a name="start-your-engine" class="anchor" href="#start-your-engine"><span class="octicon octicon-link"></span></a>Start Your Engine</h3>

<h4>
<a name="log-in" class="anchor" href="#log-in"><span class="octicon octicon-link"></span></a>Log In</h4>

<p><img src="https://raw.github.com/SQLab/cloudos-exercise/master/img/login.png" alt="Log In"></p>

<h4>
<a name="launch-your-first-instance" class="anchor" href="#launch-your-first-instance"><span class="octicon octicon-link"></span></a>Launch Your First Instance</h4>

<p><img src="https://raw.github.com/SQLab/cloudos-exercise/master/img/first_launch_1.png" alt="First Instance"></p>

<p><img src="https://raw.github.com/SQLab/cloudos-exercise/master/img/first_launch_2.png" alt="First Instance"></p>

<h4>
<a name="say-hello-to-the-world" class="anchor" href="#say-hello-to-the-world"><span class="octicon octicon-link"></span></a>Say Hello to the World</h4>

<p><img src="https://raw.github.com/SQLab/cloudos-exercise/master/img/ping.png" alt="Ping the world"></p>

<h3>
<a name="make-yourself-a-persistent-home" class="anchor" href="#make-yourself-a-persistent-home"><span class="octicon octicon-link"></span></a>Make Yourself a Persistent Home</h3>

<h4>
<a name="check-out-existing-block-devices" class="anchor" href="#check-out-existing-block-devices"><span class="octicon octicon-link"></span></a>Check out existing block devices</h4>

<pre><code>$ find /dev/ -type b | grep vd
/dev/vda
</code></pre>

<h4>
<a name="add-a-new-volume" class="anchor" href="#add-a-new-volume"><span class="octicon octicon-link"></span></a>Add a New Volume</h4>

<p><img src="https://raw.github.com/SQLab/cloudos-exercise/master/img/add_new_volume_1.png" alt="Adding a new volume"></p>

<p><img src="https://raw.github.com/SQLab/cloudos-exercise/master/img/add_new_volume_2.png" alt="Adding a new volume"></p>

<h4>
<a name="attach-the-new-volume" class="anchor" href="#attach-the-new-volume"><span class="octicon octicon-link"></span></a>Attach the New Volume</h4>

<p><img src="https://raw.github.com/SQLab/cloudos-exercise/master/img/attach_new_volume_1.png" alt="Attaching the new volume"></p>

<p><img src="https://raw.github.com/SQLab/cloudos-exercise/master/img/attach_new_volume_2.png" alt="Attaching the new volume"></p>

<pre><code>$ find /dev/ -type b | grep vd
/dev/vda
/dev/vdb
</code></pre>

<h4>
<a name="partition-the-new-volume" class="anchor" href="#partition-the-new-volume"><span class="octicon octicon-link"></span></a>Partition the New Volume</h4>

<pre><code>$ sudo fdisk /dev/vdb
...
Command (m for help): p

Disk /dev/vdb: 1073 MB, 1073741824 bytes
...

Command (m for help): n
...
Select (default p): &lt;Enter&gt;
Partition number (1-4, default 1): &lt;Enter&gt;
First sector (2048-2097151, default 2048): &lt;Enter&gt;
Using default value 2048
Last sector, +sectors or +size{K,M,G} (2048-2097151, default 2097151): &lt;Enter&gt;
Using default value 2097151

Command (m for help): p

...
Device Boot     Start   End         Blocks      Id      System
/dev/vdb1       2048    2097151     1047552     83      Linux

Command (m for help): w
</code></pre>

<h4>
<a name="create-filesystem-and-mount-the-new-volume" class="anchor" href="#create-filesystem-and-mount-the-new-volume"><span class="octicon octicon-link"></span></a>Create filesystem and Mount the New Volume</h4>

<pre><code>$ sudo mkfs.ext4 /dev/vdb1
...
$ sudo mount /dev/vdb1 /mnt
$ mount
/dev/vdb1 on /mnt type ext4 (...)
</code></pre>

<h3>
<a name="build-a-better-network" class="anchor" href="#build-a-better-network"><span class="octicon octicon-link"></span></a>Build a Better Network</h3>

<h4>
<a name="destruction-before-construction" class="anchor" href="#destruction-before-construction"><span class="octicon octicon-link"></span></a>Destruction Before Construction</h4>

<pre><code>$ cd devstack
$ ./unstack.sh
</code></pre>

<h4>
<a name="enable-neutron" class="anchor" href="#enable-neutron"><span class="octicon octicon-link"></span></a>Enable Neutron</h4>

<p>Add the following into <code>localrc</code> file</p>

<pre><code># enable neutron
disable_service n-net
enable_service q-svc
enable_service q-agt
enable_service q-dhcp
enable_service q-l3
enable_service q-meta
enable_service neutron
</code></pre>

<h4>
<a name="start-your-engine-again" class="anchor" href="#start-your-engine-again"><span class="octicon octicon-link"></span></a>Start Your Engine Again</h4>

<pre><code>$ ./stack.sh
</code></pre>

<h2>
<a name="exercise-2" class="anchor" href="#exercise-2"><span class="octicon octicon-link"></span></a>Exercise #2</h2>

<p><a href="http://www.openstack.org/software/havana/">OpenStack Havana released on 10/17, 2013</a>,
so we're moving on to Havana. Before started the main exercises, there are a few things
we need to do first.</p>

<p>First, stop devstack and pull down the latest devstack</p>

<pre><code>$ cd devstack
$ ./unstack.sh
$ git pull
</code></pre>

<p>Second, upgrade openvswitch. The version of openvswitch package in Ubuntu 12.04 is too
old to work properly with the latest Neutron.</p>

<pre><code>$ echo 'deb http://ubuntu-cloud.archive.canonical.com/ubuntu precise-updates/havana main' | sudo tee /etc/apt/sources.list.d/cloud-archive.list
$ sudo apt-get update
$ sudo apt-get install openvswitch-common openvswitch-datapath-dkms openvswitch-switch
$ sudo reboot
</code></pre>

<h3>
<a name="multi-node-setup" class="anchor" href="#multi-node-setup"><span class="octicon octicon-link"></span></a>Multi-node Setup</h3>

<p>Normally, a production OpenStack platform would consist of three kinds of nodes,
controller node(s), network node(s) and compute nodes. In the previous exercise,
we have built up a single node OpenStack setup. Let's call this node the controller
node in this document, though it also acts as a network node and a compute node.
And now, we're going to add an extra compute node.</p>

<h4>
<a name="configure-the-contoller-node" class="anchor" href="#configure-the-contoller-node"><span class="octicon octicon-link"></span></a>Configure the Contoller Node</h4>

<p>Modify your localrc like this, and replace  with your settings.</p>

<pre><code># localrc

DATABASE_PASSWORD=&lt;password&gt;
RABBIT_PASSWORD=&lt;password&gt;
SERVICE_TOKEN=&lt;password&gt;
SERVICE_PASSWORD=&lt;password&gt;
ADMIN_PASSWORD=&lt;password&gt;

# enable neutron
disable_service n-net
enable_service q-svc
enable_service q-agt
enable_service q-dhcp
enable_service q-l3
enable_service q-meta
enable_service neutron

MULTI_HOST=1

Q_PLUGIN=ml2
ENABLE_TENANT_TUNNELS=True

HOST_IP=&lt;ip address of this node&gt;
VNCSERVER_LISTEN=$HOST_IP
VNCSERVER_PROXYCLIENT_ADDRESS=$HOST_IP
</code></pre>

<p>And start devstack</p>

<pre><code>$ cd devstack
$ ./stack.sh
</code></pre>

<h4>
<a name="setup-an-extra-compute-node" class="anchor" href="#setup-an-extra-compute-node"><span class="octicon octicon-link"></span></a>Setup an Extra Compute Node</h4>

<p>The host environment of the extra compute node is just the same as the original node.
It depends on how you want it to be setup. For example, if you install the controller
node as an VM, you can simply clone a new one from it, and replace the ip and hostname
with a different one. Also, don't forget to upgrade the openvswitch just like what we
did above for the controller node.</p>

<h4>
<a name="configure-the-new-compute-node" class="anchor" href="#configure-the-new-compute-node"><span class="octicon octicon-link"></span></a>Configure the New Compute Node</h4>

<p>Modify your localrc like this, and replace  with your settings.</p>

<pre><code># localrc

DATABASE_PASSWORD=&lt;password&gt;
RABBIT_PASSWORD=&lt;password&gt;
SERVICE_TOKEN=&lt;password&gt;
SERVICE_PASSWORD=&lt;password&gt;
ADMIN_PASSWORD=&lt;password&gt;

MULTI_HOST=1

SERVICE_HOST=&lt;ip address of the controller node&gt;
GLANCE_HOSTPORT=$SERVICE_HOST:9292
MYSQL_HOST=$SERVICE_HOST
RABBIT_HOST=$SERVICE_HOST
Q_HOST=$SERVICE_HOST
MATCHMAKER_REDIS_HOST=$SERVICE_HOST

ENABLED_SERVICES=n-cpu,n-api,n-novnc,rabbit,q-agt,neutron

Q_PLUGIN=ml2
ENABLE_TENANT_TUNNELS=True

HOST_IP=&lt;ip address of this node&gt;
VNCSERVER_LISTEN=$HOST_IP
VNCSERVER_PROXYCLIENT_ADDRESS=$HOST_IP
</code></pre>

<p>And start devstack</p>

<pre><code>$ cd devstack
$ ./stack.sh
</code></pre>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">CloudOS Exercises maintained by <a href="https://github.com/SQLab">SQLab</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-42632450-3");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>


  </body>
</html>
